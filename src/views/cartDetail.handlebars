<h1 class="text-center my-4">🛒 Detalle del Carrito</h1>

{{#if cart.products.length}}
  <div class="container">
    <div class="row">
      {{#each cart.products}}
        <div class="col-md-6 mb-4">
          <div class="card shadow-sm h-100">
            <div class="card-body">
              <h4 class="card-title text-primary">{{this.product.title}}</h4>
              <p class="card-text"><b>Descripción:</b> {{this.product.description}}</p>
              <p class="card-text"><b>Categoría:</b> {{this.product.category}}</p>
              <p class="card-text"><b>Precio:</b> ${{this.product.price}}</p>
              <p class="card-text"><b>Cantidad:</b> {{this.quantity}}</p>
              <p class="card-text text-success"><b>Subtotal:</b> ${{multiply this.product.price this.quantity}}</p>

              <!-- Botón eliminar -->
              <button 
                class="btn btn-danger btn-sm mt-2" 
                onclick="removeFromCart('{{../cart._id}}','{{this.product._id}}')">
                ❌ Eliminar
              </button>
            </div>
          </div>
        </div>
      {{/each}}
    </div>

    <!-- Total -->
    <div class="text-end mt-4">
      <div class="alert alert-success">
        <h3 class="fw-bold">Total: ${{calcTotal cart.products}}</h3>
      </div>
      <button 
        class="btn btn-outline-danger btn-sm mt-2" 
        onclick="clearCart('{{cart._id}}')">
        🗑️ Vaciar Carrito
      </button>
    </div>
  </div>

{{else}}
  <div class="alert alert-warning text-center mt-4">
    El carrito está vacío 🛒
  </div>
{{/if}}

<div class="text-center mt-4">
  <a href="/products" class="btn btn-primary">⬅️ Volver a productos</a>
</div>

<script>
  // ❌ Eliminar un producto
  async function removeFromCart(cid, pid) {
    const res = await fetch(`/api/carts/${cid}/products/${pid}`, {
      method: "DELETE"
    });
    if (res.ok) {
      alert("Producto eliminado!");
      location.reload(); 
    } else {
      alert("Error al eliminar producto ❌");
    }
  }

  // 🗑️ Vaciar carrito completo
  async function clearCart(cid) {
    const res = await fetch(`/api/carts/${cid}`, {
      method: "DELETE"
    });
    if (res.ok) {
      alert("Carrito vaciado!");
      location.reload();
    } else {
      alert("Error al vaciar carrito ❌");
    }
  }
</script>




